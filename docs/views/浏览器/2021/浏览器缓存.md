---
title: 浏览器缓存
date: 2021-04-05
categories:
 - 浏览器
author: 青菜白玉汤
---

## 概述
浏览器缓存也成为HTTP缓存，其机制是根据HTTP报文的缓存标志进行的

简单的流程如图
![http cache](https://user-gold-cdn.xitu.io/2018/4/19/162db6359673e7d0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

1. 每次浏览器发起请求时，都会先在浏览器缓存中查找该请求的结果及缓存标识
2. 浏览器每拿到返回的请求结果都会将给结果和缓存标识存储浏览器缓存中


根据`是否向服务器重新发起HTTP请求`将缓存过程分成两个部分：**强制缓存**和**协商缓存**

## 强制缓存
向浏览器缓存查找结果时，并根据该结果的缓存规则来决定是否使用该缓存结果的过程

1. 不存再该缓存结果和缓存标识，强制缓存失效，直接向服务器发起请求
2. 存在该缓存结果和缓存标识，但是已失效，强制缓存失效，使用协商缓存
3. 存在该缓存结果和缓存标识，结果尚未失效，强制缓存生效，直接返回该结果

:::tip
缓存规则：有Expires和Cache-Control决定，后者优先于前者
缓存的位置：from memory cache（内存）和from disk cache（硬盘）
:::

## 协商缓存
强制缓存失效后，浏览器携带缓存标识向服务器发起请求，有服务器根据缓存标识决定是否使用缓存的过程

1. 响应码为304，该资源无更新，直接获取请求的缓存结果
2. 响应码为200，资源更新，返回更新后的资源，并将该资源缓存起来

## 三句话总结
1. 老方法Expires，记录的绝对值
2. 新方法Cache-Control，记录时间的相对值
3. 获取缓存时检测缓存是否过期，如果没过期就取缓存，优先从内存，其次是硬盘，如果过期，则与服务进行协商缓存，如果仍可用，就取缓存，否则获取新资源并缓存起来